# Primitive DB - Простая база данных

Учебный проект по созданию простой базы данных на Python.

## Установка

### Из исходного кода

```bash
# Клонируйте репозиторий
git clone git@github.com:prinstonsam/project-1_samsonov_m25-555.git
cd project-2_samsonov_m25-555

# Установите зависимости
make install

# Соберите пакет
make build

# Установите пакет
make package-install
```

## Использование

Запустите базу данных командой:

```bash
project
```

или через Poetry:

```bash
poetry run project
```

или через make:

```bash
make project
```

## Управление таблицами

База данных поддерживает следующие команды для работы с таблицами:

### Команды

- `create_table <имя_таблицы> <столбец1:тип> <столбец2:тип> ...` - создать таблицу
- `list_tables` - показать список всех таблиц
- `drop_table <имя_таблицы>` - удалить таблицу
- `help` - показать справку
- `exit` - выйти из программы

### Поддерживаемые типы данных

- `int` - целые числа
- `str` - строки
- `bool` - логические значения

**Примечание:** При создании таблицы автоматически добавляется столбец `ID:int` в качестве первого столбца.

### Примеры использования

```bash
# Создание таблицы
>>>Введите команду: create_table users name:str age:int is_active:bool
Таблица "users" успешно создана со столбцами: ID:int, name:str, age:int, is_active:bool

# Попытка создать существующую таблицу
>>>Введите команду: create_table users name:str
Ошибка: Таблица "users" уже существует.

# Просмотр всех таблиц
>>>Введите команду: list_tables
- users

# Удаление таблицы
>>>Введите команду: drop_table users
Таблица "users" успешно удалена.

# Попытка удалить несуществующую таблицу
>>>Введите команду: drop_table products
Ошибка: Таблица "products" не существует.

# Справка
>>>Введите команду: help

***Процесс работы с таблицей***
Функции:
<command> create_table <имя_таблицы> <столбец1:тип> .. - создать таблицу
<command> list_tables - показать список всех таблиц
<command> drop_table <имя_таблицы> - удалить таблицу

Общие команды:
<command> exit - выход из программы
<command> help - справочная информация

# Выход
>>>Введите команду: exit
```

## CRUD-операции

База данных поддерживает полный набор CRUD-операций (Create, Read, Update, Delete) для работы с данными в таблицах.

### Команды для работы с данными

- `insert into <имя_таблицы> values (<значение1>, <значение2>, ...)` - создать запись
- `select from <имя_таблицы>` - прочитать все записи
- `select from <имя_таблицы> where <столбец> = <значение>` - прочитать записи по условию
- `update <имя_таблицы> set <столбец1> = <новое_значение1> where <столбец_условия> = <значение_условия>` - обновить запись
- `delete from <имя_таблицы> where <столбец> = <значение>` - удалить запись
- `info <имя_таблицы>` - вывести информацию о таблице

### Примеры использования CRUD-операций

```bash
# Создание записи (ID генерируется автоматически)
>>>Введите команду: insert into users values ("Igor", 50, true)
Запись с ID=1 успешно добавлена в таблицу "users".

# Выборка всех записей
>>>Введите команду: select from users
+----+--------+-----+-----------+
| ID |  name  | age | is_active |
+----+--------+-----+-----------+
| 1  | Igor   | 50  |    True   |
+----+--------+-----+-----------+

# Выборка с условием
>>>Введите команду: select from users where age = 50
+----+--------+-----+-----------+
| ID |  name  | age | is_active |
+----+--------+-----+-----------+
| 1  | Igor   | 50  |    True   |
+----+--------+-----+-----------+

# Обновление записи
>>>Введите команду: update users set age = 51 where name = "Igor"
Запись с ID=1 в таблице "users" успешно обновлена.

# Удаление записи
>>>Введите команду: delete from users where ID = 1
Запись с ID=1 успешно удалена из таблицы "users".

# Информация о таблице
>>>Введите команду: info users
Таблица: users
Столбцы: ID:int, name:str, age:int, is_active:bool
Количество записей: 0
```

### Подтверждение действий

Опасные операции (удаление таблицы, удаление записей) требуют подтверждения:

```bash
>>>Введите команду: drop_table users
Вы уверены, что хотите выполнить "удаление таблицы"? [y/n]: n
Операция отменена.

>>>Введите команду: delete from users where ID = 1
Вы уверены, что хотите выполнить "удаление записи"? [y/n]: y
Запись с ID=1 успешно удалена из таблицы "users".
```

### Логирование времени выполнения

Операции с файлами (insert, select) логируют время выполнения:

```bash
>>>Введите команду: insert into users values ("Sergei", 28, true)
Функция insert выполнилась за 0.001 секунд.
Запись с ID=1 успешно добавлена в таблицу "users".

>>>Введите команду: select from users
Функция select выполнилась за 0.000 секунд.
+----+--------+-----+-----------+
| ID |  name  | age | is_active |
+----+--------+-----+-----------+
| 1  | Igor   | 50  |    True   |
+----+--------+-----+-----------+
```

### Кэширование результатов

Результаты SELECT кэшируются для повышения производительности. Кэш автоматически очищается при изменении данных (insert, update, delete).

## Демонстрация

[![asciicast](https://asciinema.org/a/Py0B810qe6AgL49z4Z0l859SP.svg)](https://asciinema.org/a/Py0B810qe6AgL49z4Z0l859SP)

## Разработка

### Структура проекта

```
src/primitive_db/
├── __init__.py
├── main.py       # Точка входа в приложение
├── engine.py     # Основной цикл, обработка ввода пользователя и вызов команд
├── core.py       # Основная бизнес-логика (создание/удаление таблиц, CRUD-операции)
├── parser.py     # Функции для разбора сложных команд (where, set, values)
├── decorators.py # Декораторы (handle_db_errors, confirm_action, log_time) и замыкание для кэширования
├── utils.py      # Вспомогательные функции для работы с файловой системой
└── constants.py  # Константы проекта
```

### Команды для разработки

```bash
# Установить зависимости
make install

# Запустить проект
make project

# Собрать пакет
make build

# Отладка публикации
make publish

# Установить собранный пакет
make package-install
```

## Хранение данных

### Метаданные таблиц

Метаданные о таблицах хранятся в файле `./storage/db_meta.json` в формате JSON:

```json
{
  "users": ["ID:int", "name:str", "age:int", "is_active:bool"],
  "products": ["ID:int", "title:str", "price:int"]
}
```

### Данные таблиц

Данные каждой таблицы хранятся в отдельном JSON-файле в директории `./data/`. Например, для таблицы `users` создается файл `./data/users.json`:

```json
[
  {
    "ID": 1,
    "name": "Igor",
    "age": 50,
    "is_active": true
  }
]
```

## Автор

Igor Samsonov <prinstonsam@gmail.com>

## Лицензия

Учебный проект

